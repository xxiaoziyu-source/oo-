-- 优化目标：提升Roblox环境兼容性，增加错误处理，确保界面正常显示
local success, err = pcall(function()
    -- 1. 优先获取LocalPlayer，增加超时等待（避免玩家加载未完成导致失败）
    local LocalPlayer = game:GetService("Players").LocalPlayer
    if not LocalPlayer then
        warn("未找到本地玩家，等待5秒后重试...")
        wait(5)
        LocalPlayer = game:GetService("Players").LocalPlayer
        if not LocalPlayer then error("无法获取本地玩家，脚本终止") end
    end

    -- 2. 安全获取PlayerGui，避免直接WaitForChild超时
    local PlayerGui = LocalPlayer:FindFirstChild("PlayerGui")
    if not PlayerGui then
        PlayerGui = Instance.new("PlayerGui")
        PlayerGui.Parent = LocalPlayer
        warn("PlayerGui不存在，已自动创建")
    end

    -- 3. 创建主界面窗口（增加同名界面检测，避免重复创建）
    local ScreenGui = PlayerGui:FindFirstChild("XX缝合脚本界面")
    if ScreenGui then ScreenGui:Destroy() end -- 删除旧界面
    ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "XX缝合脚本界面"
    ScreenGui.Parent = PlayerGui
    ScreenGui.IgnoreGuiInset = true -- 忽略屏幕边缘偏移（适配手机/电脑不同分辨率）

    -- 4. 主窗口框架（增加ZIndex，确保界面在最上层）
    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 500, 0, 300)
    MainFrame.Position = UDim2.new(0.5, -250, 0.5, -150)
    MainFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    MainFrame.BorderSizePixel = 2
    MainFrame.BorderColor3 = Color3.new(0.3, 0.3, 0.3)
    MainFrame.ZIndex = 100 -- 确保界面不被其他UI遮挡
    MainFrame.Parent = ScreenGui

    -- 5. 标题栏（修复原脚本中AuthorLabel位置错误的问题）
    local TitleBar = Instance.new("Frame")
    TitleBar.Size = UDim2.new(1, 0, 0, 30)
    TitleBar.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    TitleBar.ZIndex = 101
    TitleBar.Parent = MainFrame

    -- 标题文本（原脚本无问题，保留）
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(0.7, 0, 1, 0)
    TitleLabel.Position = UDim2.new(0, 10, 0, 0)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = "XX缝合脚本"
    TitleLabel.TextColor3 = Color3.new(1, 1, 1)
    TitleLabel.TextSize = 18
    TitleLabel.ZIndex = 102
    TitleLabel.Parent = TitleBar

    -- 作者文本（修复原脚本中“TitleLabel.Position”写错的问题，改为AuthorLabel）
    local AuthorLabel = Instance.new("TextLabel")
    AuthorLabel.Size = UDim2.new(0.3, 0, 1, 0)
    AuthorLabel.Position = UDim2.new(0.7, 10, 0, 0) -- 原错误：写为TitleLabel.Position
    AuthorLabel.BackgroundTransparency = 1
    AuthorLabel.Text = "作者:XX"
    AuthorLabel.TextColor3 = Color3.new(1, 1, 1)
    AuthorLabel.TextSize = 14
    AuthorLabel.ZIndex = 102
    AuthorLabel.Parent = TitleBar

    -- 关闭按钮（保留原功能，增加ZIndex）
    local CloseButton = Instance.new("TextButton")
    CloseButton.Size = UDim2.new(0, 20, 0, 20)
    CloseButton.Position = UDim2.new(1, -25, 0, 5)
    CloseButton.BackgroundColor3 = Color3.new(0.6, 0.2, 0.2)
    CloseButton.Text = "X"
    CloseButton.TextColor3 = Color3.new(1, 1, 1)
    CloseButton.ZIndex = 102
    CloseButton.Parent = TitleBar
    CloseButton.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)

    -- 6. 侧边功能栏（保留原功能，增加ZIndex）
    local SideBar = Instance.new("Frame")
    SideBar.Size = UDim2.new(0, 100, 1, -30)
    SideBar.Position = UDim2.new(0, 0, 0, 30)
    SideBar.BackgroundColor3 = Color3.new(0.25, 0.25, 0.25)
    SideBar.ZIndex = 101
    SideBar.Parent = MainFrame

    -- 功能按钮创建函数（保留原逻辑）
    local function createFunctionButton(name, yPos)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 0, 40)
        btn.Position = UDim2.new(0, 0, 0, yPos)
        btn.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
        btn.Text = name
        btn.TextColor3 = Color3.new(1, 1, 1)
        btn.ZIndex = 102
        btn.Parent = SideBar
        -- 增加按钮 hover 效果（提升交互体验）
        btn.MouseEnter:Connect(function()
            btn.BackgroundColor3 = Color3.new(0.4, 0.4, 0.4)
        end)
        btn.MouseLeave:Connect(function()
            btn.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
        end)
        return btn
    end

    local func1Btn = createFunctionButton("功能1", 0)
    local func2Btn = createFunctionButton("功能2", 40)
    local func3Btn = createFunctionButton("功能3", 80)

    -- 7. 内容区域（保留原功能，增加ZIndex）
    local ContentFrame = Instance.new("Frame")
    ContentFrame.Size = UDim2.new(1, -100, 1, -30)
    ContentFrame.Position = UDim2.new(0, 100, 0, 30)
    ContentFrame.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
    ContentFrame.ZIndex = 101
    ContentFrame.Parent = MainFrame

    -- 功能1内容框（保留原功能）
    local Func1Content = Instance.new("Frame")
    Func1Content.Size = UDim2.new(1, -10, 0, 50)
    Func1Content.Position = UDim2.new(0, 10, 0, 10)
    Func1Content.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    Func1Content.ZIndex = 102
    Func1Content.Parent = ContentFrame

    local Func1Label = Instance.new("TextLabel")
    Func1Label.Size = UDim2.new(1, 0, 1, 0)
    Func1Label.BackgroundTransparency = 1
    Func1Label.Text = "XX汉化脚本"
    Func1Label.TextColor3 = Color3.new(1, 1, 1)
    Func1Label.TextSize = 16
    Func1Label.ZIndex = 103
    Func1Label.Parent = Func1Content

    -- 功能2内容框（保留原功能）
    local Func2Content = Instance.new("Frame")
    Func2Content.Size = UDim2.new(1, -10, 0, 50)
    Func2Content.Position = UDim2.new(0, 10, 0, 80)
    Func2Content.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    Func2Content.Visible = false
    Func2Content.ZIndex = 102
    Func2Content.Parent = ContentFrame

    local Func2Label = Instance.new("TextLabel")
    Func2Label.Size = UDim2.new(1, 0, 1, 0)
    Func2Label.BackgroundTransparency = 1
    Func2Label.Text = "功能2内容区域"
    Func2Label.TextColor3 = Color3.new(1, 1, 1)
    Func2Label.TextSize = 16
    Func2Label.ZIndex = 103
    Func2Label.Parent = Func2Content

    -- 功能3内容框（保留原功能）
    local Func3Content = Instance.new("Frame")
    Func3Content.Size = UDim2.new(1, -10, 0, 50)
    Func3Content.Position = UDim2.new(0, 10, 0, 150)
    Func3Content.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    Func3Content.Visible = false
    Func3Content.ZIndex = 102
    Func3Content.Parent = ContentFrame

    local Func3Label = Instance.new("TextLabel")
    Func3Label.Size = UDim2.new(1, 0, 1, 0)
    Func3Label.BackgroundTransparency = 1
    Func3Label.Text = "功能3内容区域"
    Func3Label.TextColor3 = Color3.new(1, 1, 1)
    Func3Label.TextSize = 16
    Func3Label.ZIndex = 103
    Func3Label.Parent = Func3Content

    -- 8. 功能按钮点击事件（保留原逻辑）
    func1Btn.MouseButton1Click:Connect(function()
        Func1Content.Visible = true
        Func2Content.Visible = false
        Func3Content.Visible = false
    end)
    func2Btn.MouseButton1Click:Connect(function()
        Func1Content.Visible = false
        Func2Content.Visible = true
        Func3Content.Visible = false
    end)
    func3Btn.MouseButton1Click:Connect(function()
        Func1Content.Visible = false
        Func2Content.Visible = false
        Func3Content.Visible = true
    end)

    print("脚本执行成功，界面已创建")
end)

-- 9. 错误捕获：若脚本执行失败，输出具体错误原因（方便排查）
if not success then
    warn("脚本执行失败：" .. err)
end
